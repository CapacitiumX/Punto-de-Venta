<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punto de Venta LIGERO üì¶</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #1e293b; color: white; display: flex; height: 100vh; overflow: hidden; }
        
        /* Men√∫ Lateral */
        .sidebar { width: 200px; background-color: #0f172a; padding: 20px; display: flex; flex-direction: column; gap: 10px; border-right: 1px solid #334155; }
        .sidebar h2 { color: #38bdf8; margin-bottom: 20px; font-size: 18px; text-align: center; }
        .menu-btn { padding: 15px; background: #334155; border: none; color: white; cursor: pointer; text-align: left; border-radius: 8px; transition: 0.2s; font-size: 16px; }
        .menu-btn:hover, .menu-btn.active { background: #38bdf8; color: #0f172a; font-weight: bold; }

        /* √Årea Principal */
        .main-content { flex: 1; padding: 20px; display: flex; flex-direction: column; overflow-y: auto; }
        
        /* Pantallas */
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* CAJA REGISTRADORA */
        .register-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; height: 100%; }
        .product-list { background: #334155; border-radius: 10px; padding: 10px; overflow-y: auto; height: 70vh; }
        .totals-panel { background: #0f172a; border-radius: 10px; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }

        /* Input Gigante para Esc√°ner */
        #codeInput { width: 100%; padding: 15px; font-size: 20px; background: #1e293b; border: 2px solid #38bdf8; color: white; border-radius: 8px; outline: none; margin-bottom: 10px; }
        #codeInput:focus { box-shadow: 0 0 15px rgba(56, 189, 248, 0.5); }

        /* Tabla de Productos en Ticket */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 10px; color: #94a3b8; border-bottom: 1px solid #475569; }
        td { padding: 10px; border-bottom: 1px solid #475569; }
        .price-col { font-weight: bold; color: #4ade80; }
        
        /* Totales Gigantes */
        .big-total { font-size: 40px; font-weight: bold; color: #4ade80; text-align: right; margin: 20px 0; }
        .pay-btn { width: 100%; padding: 20px; font-size: 24px; background: #22c55e; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .pay-btn:hover { background: #16a34a; }

        /* INVENTARIO */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #94a3b8; }
        .form-group input { width: 100%; padding: 10px; background: #334155; border: 1px solid #475569; color: white; border-radius: 4px; }
        .add-btn { background: #38bdf8; color: #0f172a; padding: 10px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; }

        /* Modal Cobro */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: #1e293b; padding: 30px; border-radius: 10px; width: 400px; text-align: center; border: 1px solid #475569; }
        .change-display { font-size: 30px; color: #facc15; margin: 20px 0; }
        
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>üè™ TIENDITA POS</h2>
        <button class="menu-btn active" onclick="showScreen('pos')">üõí Caja (Venta)</button>
        <button class="menu-btn" onclick="showScreen('inventory')">üì¶ Inventario</button>
        <button class="menu-btn" onclick="showScreen('reports')">üìä Corte de Caja</button>
    </div>

    <div class="main-content">
        
        <div id="pos" class="screen active">
            <div class="register-grid">
                <div>
                    <input type="text" id="codeInput" placeholder="üîç Escanea o escribe c√≥digo aqu√≠..." autocomplete="off">
                    <div class="product-list">
                        <table id="ticketTable">
                            <thead>
                                <tr>
                                    <th>Cant.</th>
                                    <th>Producto</th>
                                    <th>Precio</th>
                                    <th>X</th>
                                </tr>
                            </thead>
                            <tbody id="ticketBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="totals-panel">
                    <div>
                        <h3>Total a Pagar:</h3>
                        <div class="big-total" id="displayTotal">$0.00</div>
                        <p style="color:#94a3b8; text-align: right;" id="itemCount">0 Art√≠culos</p>
                    </div>
                    <button class="pay-btn" onclick="openPayModal()">COBRAR (F2)</button>
                </div>
            </div>
        </div>

        <div id="inventory" class="screen">
            <h1>üì¶ Gesti√≥n de Productos</h1>
            <div style="background:#334155; padding:20px; border-radius:8px; margin-bottom:20px;">
                <h3>Agregar Nuevo Producto</h3>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="newCode" placeholder="C√≥digo de Barras" style="flex:1; padding:10px;">
                    <input type="text" id="newName" placeholder="Nombre del Producto" style="flex:2; padding:10px;">
                    <input type="number" id="newPrice" placeholder="Precio ($)" style="width:100px; padding:10px;">
                    <button class="add-btn" onclick="addProduct()">Guardar</button>
                </div>
            </div>
            <table style="background:#334155; border-radius:8px;">
                <thead><tr><th>C√≥digo</th><th>Nombre</th><th>Precio</th><th>Acci√≥n</th></tr></thead>
                <tbody id="inventoryList"></tbody>
            </table>
        </div>

        <div id="reports" class="screen">
            <h1>üìä Corte de Caja del D√≠a</h1>
            <div style="display:flex; gap:20px; margin-top:20px;">
                <div style="background:#334155; padding:20px; border-radius:8px; flex:1; text-align:center;">
                    <h3>Ventas Totales Hoy</h3>
                    <div class="big-total" id="dailyTotal" style="text-align:center;">$0.00</div>
                </div>
                <div style="background:#334155; padding:20px; border-radius:8px; flex:1; text-align:center;">
                    <h3>Tickets Emitidos</h3>
                    <div class="big-total" id="ticketsCount" style="text-align:center; color:#38bdf8;">0</div>
                </div>
            </div>
            <button onclick="clearSales()" style="margin-top:20px; background:#ef4444; color:white; border:none; padding:10px; border-radius:4px; cursor:pointer;">‚ö†Ô∏è Reiniciar Corte de Caja</button>
        </div>
    </div>

    <div id="payModal" class="modal">
        <div class="modal-content">
            <h2>üí∞ Cobrar</h2>
            <h1 id="modalTotal" style="color:#4ade80">$0.00</h1>
            
            <div class="form-group">
                <label>Recibido del Cliente ($):</label>
                <input type="number" id="cashReceived" style="font-size:20px; text-align:center;" oninput="calcChange()">
            </div>
            
            <div class="change-display" id="changeDisplay">Cambio: $0.00</div>
            
            <div style="display:flex; gap:10px; justify-content:center; margin-top:20px;">
                <button class="add-btn" style="background:#22c55e; width:100%;" onclick="finalizeSale()">CONFIRMAR VENTA</button>
                <button class="add-btn" style="background:#ef4444;" onclick="closePayModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS (LocalStorage) ---
        let products = JSON.parse(localStorage.getItem('pos_products')) || [];
        let sales = JSON.parse(localStorage.getItem('pos_sales')) || [];
        let currentCart = [];

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            renderInventory();
            updateReports();
            document.getElementById('codeInput').focus();
        });

        // --- L√ìGICA DE CAJA ---
        const codeInput = document.getElementById('codeInput');

        // Escuchar "Enter" (Scanner o Teclado)
        codeInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                const code = this.value;
                if(code) addToCart(code);
                this.value = ''; // Limpiar para el siguiente
            }
        });

        function addToCart(code) {
            const product = products.find(p => p.code === code);
            
            if (product) {
                // Si existe, agregarlo
                const existingItem = currentCart.find(item => item.code === code);
                if (existingItem) {
                    existingItem.qty++;
                } else {
                    currentCart.push({ ...product, qty: 1 });
                }
                renderCart();
            } else {
                alert("‚ùå Producto no encontrado. Reg√≠stralo en Inventario.");
                playErrorSound();
            }
        }

        function renderCart() {
            const tbody = document.getElementById('ticketBody');
            tbody.innerHTML = '';
            let total = 0;
            let count = 0;

            currentCart.forEach((item, index) => {
                const subtotal = item.price * item.qty;
                total += subtotal;
                count += item.qty;
                
                tbody.innerHTML += `
                    <tr>
                        <td>${item.qty}</td>
                        <td>${item.name}</td>
                        <td class="price-col">$${subtotal.toFixed(2)}</td>
                        <td><button onclick="removeFromCart(${index})" style="background:none; border:none; color:#ef4444; cursor:pointer;">üóëÔ∏è</button></td>
                    </tr>
                `;
            });

            document.getElementById('displayTotal').innerText = `$${total.toFixed(2)}`;
            document.getElementById('itemCount').innerText = `${count} Art√≠culos`;
            
            // Mantener el scroll abajo
            const list = document.querySelector('.product-list');
            list.scrollTop = list.scrollHeight;
        }

        function removeFromCart(index) {
            currentCart.splice(index, 1);
            renderCart();
            document.getElementById('codeInput').focus();
        }

        // --- COBRO ---
        function openPayModal() {
            if (currentCart.length === 0) return alert("El carrito est√° vac√≠o");
            
            const total = currentCart.reduce((acc, item) => acc + (item.price * item.qty), 0);
            document.getElementById('modalTotal').innerText = `$${total.toFixed(2)}`;
            document.getElementById('payModal').style.display = 'flex';
            
            // Enfocar en "Recibido"
            setTimeout(() => document.getElementById('cashReceived').focus(), 100);
        }

        function closePayModal() {
            document.getElementById('payModal').style.display = 'none';
            document.getElementById('cashReceived').value = '';
            document.getElementById('changeDisplay').innerText = 'Cambio: $0.00';
            document.getElementById('codeInput').focus();
        }

        function calcChange() {
            const total = currentCart.reduce((acc, item) => acc + (item.price * item.qty), 0);
            const received = parseFloat(document.getElementById('cashReceived').value) || 0;
            const change = received - total;
            
            const display = document.getElementById('changeDisplay');
            if(change >= 0) {
                display.innerText = `Cambio: $${change.toFixed(2)}`;
                display.style.color = '#4ade80';
            } else {
                display.innerText = `Faltan: $${Math.abs(change).toFixed(2)}`;
                display.style.color = '#ef4444';
            }
        }

        function finalizeSale() {
            const total = currentCart.reduce((acc, item) => acc + (item.price * item.qty), 0);
            const received = parseFloat(document.getElementById('cashReceived').value) || 0;
            
            if (received < total) return alert("Falta dinero");

            // Guardar Venta
            sales.push({
                date: new Date(),
                total: total,
                items: currentCart
            });
            localStorage.setItem('pos_sales', JSON.stringify(sales));

            // Limpiar
            currentCart = [];
            renderCart();
            updateReports();
            closePayModal();
            alert("‚úÖ ¬°Venta Registrada!");
        }

        // --- INVENTARIO ---
        function addProduct() {
            const code = document.getElementById('newCode').value;
            const name = document.getElementById('newName').value;
            const price = parseFloat(document.getElementById('newPrice').value);

            if (!code || !name || !price) return alert("Llena todos los datos");

            // Verificar si ya existe
            if(products.some(p => p.code === code)) return alert("Ese c√≥digo ya existe");

            products.push({ code, name, price });
            localStorage.setItem('pos_products', JSON.stringify(products));
            
            // Limpiar inputs
            document.getElementById('newCode').value = '';
            document.getElementById('newName').value = '';
            document.getElementById('newPrice').value = '';
            
            renderInventory();
            alert("Producto Agregado");
        }

        function renderInventory() {
            const tbody = document.getElementById('inventoryList');
            tbody.innerHTML = '';
            products.forEach((p, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${p.code}</td>
                        <td>${p.name}</td>
                        <td>$${p.price}</td>
                        <td><button onclick="deleteProduct(${index})" style="color:#ef4444; background:none; border:none; cursor:pointer;">Borrar</button></td>
                    </tr>
                `;
            });
        }

        function deleteProduct(index) {
            if(confirm("¬øBorrar producto?")) {
                products.splice(index, 1);
                localStorage.setItem('pos_products', JSON.stringify(products));
                renderInventory();
            }
        }

        // --- REPORTES ---
        function updateReports() {
            // Filtrar solo ventas de hoy (Opcional, ahora suma todo el historial)
            let total = sales.reduce((acc, sale) => acc + sale.total, 0);
            document.getElementById('dailyTotal').innerText = `$${total.toFixed(2)}`;
            document.getElementById('ticketsCount').innerText = sales.length;
        }
        
        function clearSales() {
            if(confirm("¬øEst√°s seguro de poner la caja en CEROS? Se borrar√° el historial de ventas.")) {
                sales = [];
                localStorage.setItem('pos_sales', JSON.stringify(sales));
                updateReports();
            }
        }

        // --- UTILIDADES ---
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(screenId).classList.add('active');
            event.target.classList.add('active');
            
            if(screenId === 'pos') document.getElementById('codeInput').focus();
        }

        function playErrorSound() {
            // Un peque√±o beep visual o sonoro si quisieras
        }
    </script>
</body>
</html>
